<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>fGalaxy</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Courier New', monospace; overflow: hidden; }

        /* Minimalist UI Layer */
        #ui-layer {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10000; 
            display: flex;
            flex-direction: column;
            gap: 20px;
            pointer-events: none; 
        }

        #header-text {
            border-left: 2px solid #fff;
            padding-left: 15px;
        }

        /* Galaxy Styling */
        .node { transition: r 0.3s, fill 0.3s, opacity 0.3s; cursor: pointer; }
        .node-hub, .node-dir { fill: #fff !important; filter: drop-shadow(0 0 8px #fff); }
        .node:not(.node-dir):not(.node-hub) { fill: #aaa; }
        
        .link { stroke: #444; stroke-opacity: 0.3; transition: opacity 0.3s; }

        .label { fill: #fff; font-weight: bold; pointer-events: none; paint-order: stroke; stroke: #000; stroke-width: 2px; }
        .label-file { opacity: 0; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div id="header-text">
            <h1 style="margin:0; font-size: 24px;">FGALAXY</h1>
            <p style="margin:5px 0; font-size: 10px; letter-spacing: 1px;">STATUS: NEURAL_LINK_ESTABLISHED</p>
        </div>
    </div>

    <svg id="galaxy-svg" width="100vw" height="100vh"></svg>

    <script>
        const svg = d3.select("#galaxy-svg");
        const width = window.innerWidth;
        const height = window.innerHeight;
        const g = svg.append("g");

        const zoom = d3.zoom().on("zoom", (e) => {
            g.attr("transform", e.transform);
            d3.selectAll(".label-file").style("opacity", e.transform.k < 0.7 ? 0 : 0.8);
        });
        svg.call(zoom);

        d3.json("map_data.json").then(data => {
            const simulation = d3.forceSimulation(data.nodes)
                .force("link", d3.forceLink(data.links).id(d => d.id).distance(30))
                .force("charge", d3.forceManyBody().strength(-100))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collide", d3.forceCollide().radius(20));

            const link = g.append("g").selectAll("line").data(data.links).join("line").attr("class", "link");

            const node = g.append("g").selectAll("circle").data(data.nodes).join("circle")
                .attr("r", d => d.type === 'folder' ? 10 : 5)
                .attr("class", d => d.type === 'folder' ? "node node-dir" : "node")
                .call(d3.drag()
                    .on("start", e => { if (!e.active) simulation.alphaTarget(0.3).restart(); e.subject.fx = e.x; e.subject.fy = e.y; })
                    .on("drag", e => { e.subject.fx = e.x; e.subject.fy = e.y; })
                    .on("end", e => { if (!e.active) simulation.alphaTarget(0); e.subject.fx = null; e.subject.fy = null; }));

            const label = g.append("g").selectAll("text").data(data.nodes).join("text")
                .attr("class", d => d.type === 'folder' ? "label label-dir" : "label label-file")
                .text(d => d.name).attr("text-anchor", "middle").attr("dy", -15);

            simulation.on("tick", () => {
                link.attr("x1", d => d.source.x).attr("y1", d => d.source.y).attr("x2", d => d.target.x).attr("y2", d => d.target.y);
                node.attr("cx", d => d.x).attr("cy", d => d.y);
                label.attr("x", d => d.x).attr("y", d => d.y);
            });
        });
    </script>
</body>
</html>
